<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AQLÂæóÁÇπË®àÁÆó</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .lucide {
            width: 16px;
            height: 16px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // Lucide Icons as SVG components
        const RotateCcw = () => (
            <svg className="lucide" viewBox="0 0 24 24">
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
            </svg>
        );

        const Undo2 = () => (
            <svg className="lucide" viewBox="0 0 24 24">
                <path d="M9 14 4 9l5-5"/>
                <path d="M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11"/>
            </svg>
        );

        const QuizScoreApp = () => {
            const initialState = {
                teamA: Array(5).fill(null).map((_, i) => ({
                    id: i + 1,
                    score: 1,
                    hasAnswerRight: true,
                    missedOnce: false
                })),
                teamB: Array(5).fill(null).map((_, i) => ({
                    id: i + 1,
                    score: 1,
                    hasAnswerRight: true,
                    missedOnce: false
                }))
            };

            const [gameState, setGameState] = useState(initialState);
            const [history, setHistory] = useState([]);
            const [editMode, setEditMode] = useState({ active: false, team: '', position: -1, type: 'score' });
            const [editValue, setEditValue] = useState('');

            // ÂêàË®àÂæóÁÇπË®àÁÆó
            const calculateTotalScore = (team) => {
                return team.reduce((total, player) => total * player.score, 1);
            };

            // „É™„Éº„ÉÅÂà§ÂÆöÔºàÊ¨°„ÅÆÊ≠£Ëß£„Åß200ÁÇπ„Å´Âà∞ÈÅî„Åô„ÇãÁï™Âè∑Ôºâ
            const getReachPositions = (team) => {
                const reachPositions = [];
                team.forEach((player, index) => {
                    if (player.hasAnswerRight) {
                        const tempTeam = [...team];
                        tempTeam[index] = { ...player, score: player.score + 1 };
                        if (calculateTotalScore(tempTeam) >= 200) {
                            reachPositions.push(index);
                        }
                    }
                });
                return reachPositions;
            };

            // Â±•Ê≠¥‰øùÂ≠ò
            const saveToHistory = () => {
                setHistory(prev => [JSON.parse(JSON.stringify(gameState)), ...prev.slice(0, 4)]);
            };

            // Ê≠£Ëß£Âá¶ÁêÜ
            const handleCorrect = (team, position) => {
                saveToHistory();
                setGameState(prev => ({
                    ...prev,
                    [team]: prev[team].map((player, index) => 
                        index === position 
                            ? { ...player, score: player.score + 1 }
                            : player
                    )
                }));
            };

            // Ë™§Á≠îÂá¶ÁêÜ
            const handleIncorrect = (team, position) => {
                saveToHistory();
                setGameState(prev => {
                    const newState = JSON.parse(JSON.stringify(prev)); // Ê∑±„ÅÑ„Ç≥„Éî„Éº„Çí‰ΩúÊàê
                    const targetTeam = newState[team];
                    const opponentTeam = newState[team === 'teamA' ? 'teamB' : 'teamA'];
                    
                    // Ë™§Á≠î„Åó„ÅüÁï™Âè∑„ÅÆÂá¶ÁêÜ
                    if (!targetTeam[position].missedOnce) {
                        // 1ÂõûÁõÆ„ÅÆË™§Á≠îÔºö„Éù„Ç§„É≥„Éà1„Å´„É™„Çª„ÉÉ„Éà„ÄÅË™§Á≠î„Éï„É©„Ç∞„ÇíÁ´ã„Å¶„Çã
                        targetTeam[position] = {
                            ...targetTeam[position],
                            score: 1,
                            missedOnce: true
                        };
                    } else {
                        // 2ÂõûÁõÆ‰ª•Èôç„ÅÆË™§Á≠îÔºö„Éù„Ç§„É≥„Éà1„Å´„É™„Çª„ÉÉ„Éà„ÄÅËß£Á≠îÊ®©Âñ™Â§±
                        targetTeam[position] = {
                            ...targetTeam[position],
                            score: 1,
                            hasAnswerRight: false
                        };
                    }
                    
                    // Áõ∏Êâã„ÉÅ„Éº„É†„ÅÆÂ§±Ê®©ËÄÖ„ÇíÂæ©Ê¥ª„Åï„Åõ„Çã
                    opponentTeam.forEach((player, index) => {
                        if (!player.hasAnswerRight) {
                            opponentTeam[index] = {
                                ...player,
                                hasAnswerRight: true,
                                missedOnce: true,
                                score: 1
                            };
                        }
                    });
                    
                    return newState;
                });
            };

            // „É™„Çª„ÉÉ„Éà
            const handleReset = () => {
                setGameState(initialState);
                setHistory([]);
            };

            // UNDO
            const handleUndo = () => {
                if (history.length > 0) {
                    setGameState(history[0]);
                    setHistory(prev => prev.slice(1));
                }
            };

            // ÊâãÂãïÁ∑®ÈõÜ
            const startEdit = (team, position, type = 'score') => {
                if (type === 'score') {
                    setEditMode({ active: true, team, position, type });
                    setEditValue(gameState[team][position].score.toString());
                } else if (type === 'status') {
                    setEditMode({ active: true, team, position, type });
                }
            };

            const saveEdit = () => {
                if (editMode.type === 'score') {
                    const newScore = parseInt(editValue);
                    if (newScore > 0) {
                        setGameState(prev => ({
                            ...prev,
                            [editMode.team]: prev[editMode.team].map((player, index) => 
                                index === editMode.position 
                                    ? { ...player, score: newScore }
                                    : player
                            )
                        }));
                    }
                }
                setEditMode({ active: false, team: '', position: -1, type: 'score' });
                setEditValue('');
            };

            const saveStatusEdit = (newStatus) => {
                setGameState(prev => ({
                    ...prev,
                    [editMode.team]: prev[editMode.team].map((player, index) => 
                        index === editMode.position 
                            ? { 
                                ...player, 
                                hasAnswerRight: newStatus.hasAnswerRight,
                                missedOnce: newStatus.missedOnce
                            }
                            : player
                    )
                }));
                setEditMode({ active: false, team: '', position: -1, type: 'score' });
            };

            const cancelEdit = () => {
                setEditMode({ active: false, team: '', position: -1, type: 'score' });
                setEditValue('');
            };

            // „Éó„É¨„Ç§„É§„Éº„ÅÆÁä∂ÊÖã„Å´Âü∫„Å•„Åè„ÇØ„É©„ÇπÂêçÂèñÂæó
            const getPlayerClasses = (player, isReach) => {
                let classes = 'p-2 rounded-lg border-2 transition-all duration-200 ';
                
                if (!player.hasAnswerRight) {
                    // Â§±Ê®©Áä∂ÊÖã
                    classes += 'bg-red-100 border-red-400 text-red-800 ';
                    if (isReach) {
                        classes += 'ring-4 ring-yellow-300 ';
                    }
                } else if (isReach) {
                    // „É™„Éº„ÉÅÁä∂ÊÖã
                    classes += 'bg-yellow-100 border-yellow-400 text-yellow-800 ring-4 ring-yellow-300 ';
                    if (player.missedOnce) {
                        classes += 'bg-gradient-to-r from-yellow-100 to-orange-100 ';
                    }
                } else if (player.missedOnce) {
                    // 1ÂõûË™§Á≠îÁä∂ÊÖã
                    classes += 'bg-orange-100 border-orange-400 text-orange-800 ';
                } else {
                    // ÈÄöÂ∏∏Áä∂ÊÖã
                    classes += 'bg-blue-50 border-blue-200 text-blue-800 ';
                }
                
                return classes;
            };

            const TeamSection = ({ teamName, teamData, teamKey }) => {
                const totalScore = calculateTotalScore(teamData);
                const reachPositions = getReachPositions(teamData);
                const isWinner = totalScore >= 200;

                return (
                    <div className="mb-6">
                        <div className="flex items-center justify-between mb-4">
                            <h2 className="text-2xl font-bold text-gray-800">{teamName}</h2>
                            <div className={`text-4xl font-bold px-4 py-2 rounded-lg ${
                                isWinner ? 'bg-green-100 text-green-800 border-2 border-green-400' :
                                totalScore >= 100 ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-800'
                            }`}>
                                {totalScore}ÁÇπ
                            </div>
                        </div>
                        
                        <div className="grid grid-cols-5 gap-2 mb-4">
                            {teamData.map((player, index) => {
                                const isReach = reachPositions.includes(index);
                                return (
                                    <div key={index} className={getPlayerClasses(player, isReach)}>
                                        <div className="text-center">
                                            <div className="text-sm font-medium">{index + 1}Áï™</div>
                                            <div className="text-2xl font-bold my-1">
                                                {editMode.active && editMode.team === teamKey && editMode.position === index && editMode.type === 'score' ? (
                                                    <input
                                                        type="number"
                                                        value={editValue}
                                                        onChange={(e) => setEditValue(e.target.value)}
                                                        className="w-12 text-center border rounded"
                                                        min="1"
                                                        onKeyDown={(e) => {
                                                            if (e.key === 'Enter') saveEdit();
                                                            if (e.key === 'Escape') cancelEdit();
                                                        }}
                                                        autoFocus
                                                    />
                                                ) : (
                                                    <span onClick={() => startEdit(teamKey, index, 'score')} className="cursor-pointer">
                                                        {player.score}
                                                    </span>
                                                )}
                                            </div>
                                            <div className="flex gap-1 mt-1">
                                                <button
                                                    onClick={() => handleCorrect(teamKey, index)}
                                                    disabled={!player.hasAnswerRight}
                                                    className="flex-1 bg-green-500 text-white text-xs py-1.5 px-1 rounded disabled:bg-gray-300 disabled:cursor-not-allowed min-h-[28px] flex items-center justify-center"
                                                >
                                                    ‚óØ
                                                </button>
                                                <button
                                                    onClick={() => handleIncorrect(teamKey, index)}
                                                    disabled={!player.hasAnswerRight}
                                                    className="flex-1 bg-red-500 text-white text-xs py-1.5 px-1 rounded disabled:bg-gray-300 disabled:cursor-not-allowed min-h-[28px] flex items-center justify-center"
                                                >
                                                    √ó
                                                </button>
                                            </div>
                                            {!player.hasAnswerRight && (
                                                <div 
                                                    className="text-xs text-red-600 mt-1 cursor-pointer hover:underline"
                                                    onClick={() => startEdit(teamKey, index, 'status')}
                                                >
                                                    Â∞ÅÈéñ
                                                </div>
                                            )}
                                            {player.missedOnce && player.hasAnswerRight && (
                                                <div 
                                                    className="text-xs text-orange-600 mt-1 cursor-pointer hover:underline"
                                                    onClick={() => startEdit(teamKey, index, 'status')}
                                                >
                                                    Ë™§Á≠îÊ∏à
                                                </div>
                                            )}
                                            {isReach && (
                                                <div className="text-xs text-yellow-700 mt-1 font-bold">„É™„Éº„ÉÅ!</div>
                                            )}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            };

            const teamAScore = calculateTotalScore(gameState.teamA);
            const teamBScore = calculateTotalScore(gameState.teamB);
            const winner = teamAScore >= 200 ? 'A„ÉÅ„Éº„É†' : teamBScore >= 200 ? 'B„ÉÅ„Éº„É†' : null;

            if (editMode.active && editMode.type === 'score') {
                return (
                    <div className="min-h-screen bg-gray-50 p-4">
                        <div className="max-w-md mx-auto bg-white rounded-lg shadow-lg p-6">
                            <h3 className="text-lg font-bold mb-4">ÂæóÁÇπ„ÇíÁ∑®ÈõÜ</h3>
                            <p className="mb-4">
                                {editMode.team === 'teamA' ? 'A„ÉÅ„Éº„É†' : 'B„ÉÅ„Éº„É†'} {editMode.position + 1}Áï™„ÅÆÂæóÁÇπ
                            </p>
                            <input
                                type="number"
                                value={editValue}
                                onChange={(e) => setEditValue(e.target.value)}
                                className="w-full p-2 border rounded mb-4"
                                min="1"
                                placeholder="ÂæóÁÇπ„ÇíÂÖ•Âäõ"
                            />
                            <div className="flex gap-2">
                                <button
                                    onClick={saveEdit}
                                    className="flex-1 bg-blue-500 text-white py-2 px-4 rounded"
                                >
                                    ‰øùÂ≠ò
                                </button>
                                <button
                                    onClick={cancelEdit}
                                    className="flex-1 bg-gray-500 text-white py-2 px-4 rounded"
                                >
                                    „Ç≠„É£„É≥„Çª„É´
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (editMode.active && editMode.type === 'status') {
                return (
                    <div className="min-h-screen bg-gray-50 p-4">
                        <div className="max-w-md mx-auto bg-white rounded-lg shadow-lg p-6">
                            <h3 className="text-lg font-bold mb-4">Áä∂ÊÖã„ÇíÁ∑®ÈõÜ</h3>
                            <p className="mb-4">
                                {editMode.team === 'teamA' ? 'A„ÉÅ„Éº„É†' : 'B„ÉÅ„Éº„É†'} {editMode.position + 1}Áï™„ÅÆÁä∂ÊÖã
                            </p>
                            <div className="space-y-3 mb-4">
                                <button
                                    onClick={() => saveStatusEdit({ hasAnswerRight: true, missedOnce: false })}
                                    className="w-full p-3 text-left bg-blue-50 border-2 border-blue-200 rounded hover:bg-blue-100"
                                >
                                    <div className="font-medium">ÈÄöÂ∏∏Áä∂ÊÖã</div>
                                    <div className="text-sm text-gray-600">Ëß£Á≠îÊ®©„ÅÇ„Çä„ÄÅË™§Á≠î„Å™„Åó</div>
                                </button>
                                <button
                                    onClick={() => saveStatusEdit({ hasAnswerRight: true, missedOnce: true })}
                                    className="w-full p-3 text-left bg-orange-50 border-2 border-orange-200 rounded hover:bg-orange-100"
                                >
                                    <div className="font-medium">1ÂõûË™§Á≠îÊ∏à„Åø</div>
                                    <div className="text-sm text-gray-600">Ëß£Á≠îÊ®©„ÅÇ„Çä„ÄÅ1ÂõûË™§Á≠îÊ∏à„Åø</div>
                                </button>
                                <button
                                    onClick={() => saveStatusEdit({ hasAnswerRight: false, missedOnce: true })}
                                    className="w-full p-3 text-left bg-red-50 border-2 border-red-200 rounded hover:bg-red-100"
                                >
                                    <div className="font-medium">Â∞ÅÈéñÁä∂ÊÖã</div>
                                    <div className="text-sm text-gray-600">Ëß£Á≠îÊ®©„Å™„Åó</div>
                                </button>
                            </div>
                            <button
                                onClick={cancelEdit}
                                className="w-full bg-gray-500 text-white py-2 px-4 rounded"
                            >
                                „Ç≠„É£„É≥„Çª„É´
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50 p-4">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <div className="flex items-center justify-between mb-6">
                                <h1 className="text-3xl font-bold text-gray-800">„ÇØ„Ç§„Ç∫Â§ß‰ºö ÂæóÁÇπË®àÁÆó</h1>
                                <div className="flex gap-2">
                                    <button
                                        onClick={handleUndo}
                                        disabled={history.length === 0}
                                        className="flex items-center gap-1 bg-blue-500 text-white px-3 py-2 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                                    >
                                        <Undo2 />
                                        UNDO
                                    </button>
                                    <button
                                        onClick={handleReset}
                                        className="flex items-center gap-1 bg-red-500 text-white px-3 py-2 rounded"
                                    >
                                        <RotateCcw />
                                        „É™„Çª„ÉÉ„Éà
                                    </button>
                                </div>
                            </div>

                            {winner && (
                                <div className="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-6">
                                    <div className="text-2xl font-bold">üéâ {winner}„ÅÆÂãùÂà©ÔºÅ</div>
                                </div>
                            )}

                            <TeamSection teamName="A„ÉÅ„Éº„É†" teamData={gameState.teamA} teamKey="teamA" />
                            <TeamSection teamName="B„ÉÅ„Éº„É†" teamData={gameState.teamB} teamKey="teamB" />

                            <div className="mt-6 p-4 bg-gray-100 rounded-lg">
                                <h3 className="font-bold mb-2">Êìç‰ΩúË™¨Êòé</h3>
                                <ul className="text-sm text-gray-600 space-y-1">
                                    <li>‚Ä¢ ÂæóÁÇπ„Çí„Çø„ÉÉ„Éó„Åô„Çã„Å®ÊâãÂãïÁ∑®ÈõÜ„Åß„Åç„Åæ„Åô</li>
                                    <li>‚Ä¢ Áä∂ÊÖãË°®Á§∫ÔºàË™§Á≠îÊ∏à„ÄÅÂ∞ÅÈéñÔºâ„Çí„Çø„ÉÉ„Éó„Åô„Çã„Å®Áä∂ÊÖã„ÇíÂ§âÊõ¥„Åß„Åç„Åæ„Åô</li>
                                    <li>‚Ä¢ ÈªÑËâ≤Ôºö„É™„Éº„ÉÅÔºàÊ¨°„ÅÆÊ≠£Ëß£„Åß200ÁÇπÂà∞ÈÅîÔºâ</li>
                                    <li>‚Ä¢ „Ç™„É¨„É≥„Ç∏Ôºö1ÂõûË™§Á≠îÊ∏à„Åø</li>
                                    <li>‚Ä¢ Ëµ§ÔºöËß£Á≠îÊ®©Â∞ÅÈéñ‰∏≠</li>
                                    <li>‚Ä¢ Áõ∏Êâã„ÉÅ„Éº„É†„ÅåË™§Á≠î„Åô„Çã„Å®Ëá™„ÉÅ„Éº„É†„ÅÆÂ∞ÅÈéñËÄÖ„ÅåÂæ©Ê¥ª</li>
                                </ul>
                                {history.length > 0 && (
                                    <div className="mt-2 text-xs text-blue-600">
                                        Â±•Ê≠¥: {history.length}‰ª∂‰øùÂ≠ò‰∏≠
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<QuizScoreApp />, document.getElementById('root'));
    </script>
</body>
</html>
